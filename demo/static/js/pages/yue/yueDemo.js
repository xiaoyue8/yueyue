define(["jquery"],function(t){(function(){var i={SNOW_COUNT:{INIT:100,DELTA:1},BACKGROUND_COLOR:"hsl(%h, 50%, %l%)",INIT_HUE:180,DELTA_HUE:.1,init:function(){this.setParameters(),this.reconstructMethod(),this.createSnow(this.SNOW_COUNT.INIT*this.countRate,!0),this.render()},setParameters:function(){this.$window=t(window),this.$container=t("#jsi-snow-container"),this.width=this.$container.width(),this.height=this.$container.height(),this.center={x:this.width/2,y:this.height/2},this.countRate=this.width*this.height/500/500,this.canvas=t("<canvas />").attr({width:this.width,height:this.height}).appendTo(this.$container).get(0),this.context=this.canvas.getContext("2d"),this.radius=Math.sqrt(this.center.x*this.center.x+this.center.y*this.center.y),this.hue=this.INIT_HUE,this.snows=[]},reconstructMethod:function(){this.render=this.render.bind(this)},createSnow:function(t,i){for(var s=0;s<t;s++)this.snows.push(new h(this.width,this.height,this.center,i))},render:function(){requestAnimationFrame(this.render);var t=this.context.createRadialGradient(this.center.x,this.center.y,0,this.center.x,this.center.y,this.radius),i=this.BACKGROUND_COLOR.replace("%h",this.hue);t.addColorStop(0,i.replace("%l",30)),t.addColorStop(.2,i.replace("%l",20)),t.addColorStop(1,i.replace("%l",5)),this.context.fillStyle=t,this.context.fillRect(0,0,this.width,this.height);for(var h=this.snows.length-1;h>=0;h--)this.snows[h].render(this.context)||this.snows.splice(h,1);this.hue+=this.DELTA_HUE,this.hue%=360,this.createSnow(this.SNOW_COUNT.DELTA,!1)}},h=function(t,i,h,s){this.width=t,this.height=i,this.center=h,this.init(s)};h.prototype={RADIUS:20,OFFSET:4,INIT_POSITION_MARGIN:20,COLOR:"rgba(255, 255, 255, 0.8)",TOP_RADIUS:{MIN:1,MAX:3},SCALE:{INIT:.04,DELTA:.01},DELTA_ROTATE:{MIN:-Math.PI/180/2,MAX:Math.PI/180/2},THRESHOLD_TRANSPARENCY:.7,VELOCITY:{MIN:-1,MAX:1},LINE_WIDTH:2,BLUR:10,init:function(t){this.setParameters(t),this.createSnow()},setParameters:function(i){this.canvas||(this.radius=this.RADIUS+2*this.TOP_RADIUS.MAX+this.LINE_WIDTH,this.length=2*this.radius,this.canvas=t("<canvas />").attr({width:this.length,height:this.length}).get(0),this.context=this.canvas.getContext("2d")),this.topRadius=this.getRandomValue(this.TOP_RADIUS);var h=2*Math.PI*Math.random();if(this.x=this.center.x+this.INIT_POSITION_MARGIN*Math.cos(h),this.y=this.center.y+this.INIT_POSITION_MARGIN*Math.sin(h),this.vx=this.getRandomValue(this.VELOCITY),this.vy=this.getRandomValue(this.VELOCITY),this.deltaRotate=this.getRandomValue(this.DELTA_ROTATE),this.scale=this.SCALE.INIT,this.deltaScale=1+500*this.SCALE.DELTA/Math.max(this.width,this.height),this.rotate=0,i)for(var s=0,e=1e3*Math.random();s<e;s++)this.x+=this.vx,this.y+=this.vy,this.scale*=this.deltaScale,this.rotate+=this.deltaRotate},getRandomValue:function(t){return t.MIN+(t.MAX-t.MIN)*Math.random()},createSnow:function(){this.context.clearRect(0,0,this.length,this.length),this.context.save(),this.context.beginPath(),this.context.translate(this.radius,this.radius),this.context.strokeStyle=this.COLOR,this.context.lineWidth=this.LINE_WIDTH,this.context.shadowColor=this.COLOR,this.context.shadowBlur=this.BLUR;for(var t=Math.PI/180*60,i=Math.sin(t),h=Math.cos(t),s=Math.random()*this.RADIUS/this.OFFSET|0,e=.5+.5*Math.random(),a=this.OFFSET*Math.random()*2,n=this.RADIUS/this.OFFSET,o=0;o<6;o++){this.context.save(),this.context.rotate(t*o);for(var r=0;r<=s;r++){var c=-this.OFFSET*r;this.context.moveTo(0,c),this.context.lineTo(c*i,c*h)}for(r=s;r<n;r++){c=-this.OFFSET*r;var d=r*(n-r+1)*e;this.context.moveTo(d,c-a),this.context.lineTo(0,c),this.context.lineTo(-d,c-a)}this.context.moveTo(0,0),this.context.lineTo(0,-this.RADIUS),this.context.arc(0,-this.RADIUS-this.topRadius,this.topRadius,Math.PI/2,2.5*Math.PI,!1),this.context.restore()}this.context.stroke(),this.context.restore()},render:function(t){return t.save(),this.scale>this.THRESHOLD_TRANSPARENCY&&(t.globalAlpha=Math.max(0,(1-this.scale)/(1-this.THRESHOLD_TRANSPARENCY)),this.scale>1||this.x<-this.radius||this.x>this.width+this.radius||this.y<-this.radius||this.y>this.height+this.radius)?(t.restore(),!1):(t.translate(this.x,this.y),t.rotate(this.rotate),t.scale(this.scale,this.scale),t.drawImage(this.canvas,-this.radius,-this.radius),t.restore(),this.x+=this.vx,this.y+=this.vy,this.scale*=this.deltaScale,this.rotate+=this.deltaRotate,!0)}},t(function(){i.init()}),t("html").one("touchstart",function(){document.getElementById("audio").play()})})()});